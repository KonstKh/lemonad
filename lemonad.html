<!DOCTYPE html>

<html>
<head>
  <title>lemonad.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>lemonad.js</h1>
        

        
      </div>

      
        
        <p>   Lemonad.js
   <a href="http://www.functionaljs.org">http://www.functionaljs.org</a>
   (c) 2013 Fogus, Ariadne Softworks
   Lemonad may be freely distributed under the MIT license</p>

        
      
        
        
<p><em>the secret JavaScript sauce</em></p>

        
          <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        
      
        
        
<h2>Dependencies</h2>

        
      
        
        
<p>Require Underscore.js if not already available.</p>

        
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_</span> <span class="o">||</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span></pre></div>
        
      
        
        
<h2>Setup</h2>

        
      
        
        
<p>Establish the root object, <code>window</code> in the browser, or <code>global</code> on the server.
<em>taken from <a href="http://underscorejs.org/">Underscore.js</a></em></p>

        
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
        
      
        
        
<p>The namespace object <code>L</code> is a function in its own right that returns
a partially applied function of an arbitrary number of arguments.
(any<em> -&gt; a) -&gt; any</em> -&gt; (any* -&gt; a)</p>

        
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">L</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span> <span class="p">{</span></pre></div>
        
      
        
        
<p>default to the native <code>bind</code> if available</p>

        
          <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">bind</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* arguments */</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span><span class="nx">fun</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Current version</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.5.4&#39;</span><span class="p">;</span></pre></div>
        
      
        
        
<h2>Internal utilities</h2>

        
      
        
        
<p>A simple function to throw an <code>Error</code></p>

        
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">fail</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        
      
        
        
<p>A portable way to get the prototype of an object based on
Dave Herman&#39;s excellent &quot;Effective JavaScript&quot;</p>

        
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">getProto</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="o">?</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">obj</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span> <span class="o">||</span> <span class="p">(</span><span class="nx">t</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">t</span> <span class="o">!==</span> <span class="s1">&#39;function&#39;</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">&quot;not an object&quot;</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="o">:</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">});</span></pre></div>
        
      
        
        
<p>Clones an object. Based on the version by
<a href="http://keithdevens.com/weblog/archive/2007/Jun/07/javascript.clone">Keith Devens</a>
until I can find a more efficient way to do it.</p>

        
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">theClonusHorror</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span>
      <span class="nx">temp</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">theClonusHorror</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>

    <span class="k">return</span> <span class="nx">temp</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        
      
        
        
<p>A temporary way to derive the name of a function. I hope to
eliminate the need sooner rather than later.
(a -&gt; b) -&gt; string</p>

        
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">nom</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="s1">&#39;function &#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">src</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">fun</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Cannot derive the name of a non-function.&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">n</span><span class="p">))</span> <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
    <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Anonymous function has no name.&quot;</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        
      
        
        
<p>Delegates down to the snapshot method if an object has one
or clones the object outright if not.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">snapshot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">thing</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">thing</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">thing</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">thing</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">theClonusHorror</span><span class="p">(</span><span class="nx">thing</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Useful tools</h2>

        
      
        
        
<p>Used as a unique value to signify certain conditions in Lemonad.
Also takes a number of args and returns an array of unique values.
any<em> -&gt; [any</em>]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>boolean -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">not</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span> <span class="k">return</span> <span class="o">!</span><span class="nx">b</span><span class="p">;</span> <span class="p">};</span></pre></div>
        
      
        
        
<p>increment, decrement and halve
number -&gt; number</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">inc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">dec</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">halve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="p">};</span></pre></div>
        
      
        
        
<p>type
{any: any} -&gt; (any* -&gt; any)</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">ctor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">?</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>a function to get at an index into an array
[any] -&gt; number -&gt; any</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">nth</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">index</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Expecting a integer as the index argument.&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isIndexed</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArguments</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Indexing not supported on non-indexed types.&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Attempting to index outside the bounds of the array.&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>&#39;explodes&#39; a string into an array of chars
string -&gt; [string]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">explode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>&#39;implodes&#39; and array of strings into a string
[string] -&gt; string</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">implode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Useful predicates</h2>

        
      
        
        
<p>Returns true if a value is &#39;existy&#39;, i.e. is not
<code>undefined</code> nor <code>null</code>
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">;</span> <span class="p">};</span></pre></div>
        
      
        
        
<p>Everything but <code>false</code> and <code>null</code> are truthy
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">x</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">falsey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">};</span></pre></div>
        
      
        
        
<h3>Type predicates</h3>

        
      
        
        
<p>A wrapper around instanceof
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isInst</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">t</span><span class="p">);</span> <span class="p">};</span></pre></div>
        
      
        
        
<p>An associative object is one where its elements are
accessed via a key or index. (i.e. array and object)
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isAssociative</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">};</span></pre></div>
        
      
        
        
<p>An indexed object is anything that allows numerical index for
accessing its elements (e.g. arrays and strings)
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isIndexed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>A reference is something that derives from a Lemonad Hole object
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isReference</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>A seq is something considered a sequential composite type (i.e. arrays and <code>arguments</code>)
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isSeq</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArguments</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span> <span class="p">};</span></pre></div>
        
      
        
        
<h3>Numeric predicates</h3>

        
      
        
        
<p>These do what you think that they do
a -&gt; boolean</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isEven</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">x</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">isZero</span><span class="p">(</span><span class="nx">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">isOdd</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isEven</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">isPos</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">isNeg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">isZero</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="o">===</span> <span class="nx">x</span><span class="p">;</span> <span class="p">};</span></pre></div>
        
      
        
        
<h2>Basic functions</h2>

        
      
        
        
<p>Concatenates one or more arrays given as arguments
[any<em>]</em> -&gt; [any*]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">head</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">head</span><span class="p">.</span><span class="nx">concat</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">head</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="p">[];</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>&#39;Pours&#39; one or more arguments into an array
any<em> -&gt; [any</em>]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">pour</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Cannot pour into a non-array.&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>&#39;Pours&#39; one array into another
[[any<em>]</em>] -&gt; [any*]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">into</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Cannot into a non-array into a non-array.&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>&#39;Constructs&#39; an array by putting an element at its front
a -&gt; [any<em>] -&gt; [a any</em>]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">construct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">head</span><span class="p">,</span> <span class="nx">tail</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">([</span><span class="nx">head</span><span class="p">],</span> <span class="nx">tail</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns all but the last element in an array
[any<em>] -&gt; [any</em>]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">butLast</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isSeq</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Cannot butLast a non-sequence&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">coll</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Merges two or more objects starting with the left-most and
applying the keys right-word
{any:any}* -&gt; {any:any}</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">merge</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* objs */</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">dest</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="o">?</span> <span class="p">{}</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">dest</span><span class="p">))</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>

    <span class="k">return</span> <span class="nx">dest</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes an array and parititions it some number of times with
sub-arrays of size n.  Allows and optional padding array as
the third argument to fill in the tail partition when n is
not sufficient to build paritions of the same size.
number -&gt; [any] -&gt; <any> -&gt; [[any]]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">coll</span><span class="p">,</span> <span class="nx">pad</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="k">return</span> <span class="p">[];</span>

      <span class="kd">var</span> <span class="nx">part</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">part</span><span class="p">))</span>
        <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">part</span><span class="p">,</span> <span class="nx">p</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">n</span><span class="p">)));</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="nx">pad</span> <span class="o">?</span> <span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">part</span><span class="p">,</span> <span class="nx">pad</span><span class="p">),</span> <span class="nx">n</span><span class="p">)]</span> <span class="o">:</span> <span class="p">[];</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">p</span><span class="p">(</span><span class="nx">coll</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">partitionAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">coll</span><span class="p">,</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">step</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">step</span><span class="p">)</span> <span class="o">?</span> <span class="nx">step</span> <span class="o">:</span> <span class="nx">n</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="k">return</span> <span class="p">[];</span>

      <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">n</span><span class="p">),</span>
                    <span class="nx">p</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">step</span><span class="p">)));</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">p</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">coll</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns an array with some item between each element
of a given array
a -&gt; [any] -&gt; [any a]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">interpose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">inter</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected an array as the second arg.&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">coll</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sz</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">coll</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sz</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">coll</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">butLast</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">mapcat</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="p">[</span><span class="nx">inter</span><span class="p">]);</span> <span class="p">},</span> <span class="nx">coll</span><span class="p">));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Weaves two or more arrays together
[any]* -&gt; [any]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">interleave</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">zip</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)),</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns an array of a value repeated a certain number of
times.
number -&gt; a -&gt; [a]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">times</span><span class="p">,</span> <span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">times</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected a number as the first arg&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">times</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">elem</span><span class="p">;</span> <span class="p">});</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>number -&gt; [any] -&gt; [any]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">cycle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">times</span><span class="p">,</span> <span class="nx">elems</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">times</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected a number as the first arg&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">mapcat</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">elems</span><span class="p">;</span>
    <span class="p">},</span> <span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">times</span><span class="p">));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns the second element in an array
[a any] -&gt; any</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">second</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;cannot take the second element of a non-array&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">coll</span><span class="p">));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns true if its arguments are monotonically
increaing values; false otherwise.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">increasing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns true if its arguments are monotonically
decreaing values; false otherwise.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">decreasing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns true if its arguments are monotonically
increaing (or pairwise equal) values; false
otherwise.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">increasingOrEq</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns true if its arguments are monotonically
decreaing (or pairwise equal) values; false
otherwise.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">decreasingOrEq</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns a function that will invoke the given method
on any object that it receives as a argument.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">walterWhite</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">invoker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span> <span class="cm">/*, args*/</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pargs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span> <span class="cm">/* args ... */</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">nom</span><span class="p">(</span><span class="nx">method</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">targetMethod</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">methodName</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">targetMethod</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">method</span> <span class="o">===</span> <span class="nx">targetMethod</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">targetMethod</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">pargs</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Builds a polymorphic function based on dispatch predicates.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">dispatcher</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/* funs */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">funs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">funs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">funIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">funIndex</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">funIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="nx">funs</span><span class="p">[</span><span class="nx">funIndex</span><span class="p">];</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">existy</span><span class="p">(</span><span class="nx">ret</span><span class="p">))</span> <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns an array with two internal arrays built from
taking an original array and spliting it at an index.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">splitAt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">index</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected a number for the first arg&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isSeq</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected an array for the second arg&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">index</span><span class="p">),</span> <span class="nx">_</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">index</span><span class="p">)];</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes every nth item from an array, returning an array of
the results.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">takeSkipping</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">n</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected a number for the first arg&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected an array for the second arg&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">coll</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">sz</span><span class="p">;</span> <span class="nx">index</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">coll</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes an object and another object of strings to strings where the second
object describes the kete renaming to occur in the first object.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">renameKeys</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">kobj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">kobj</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">nu</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">old</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">o</span><span class="p">[</span><span class="nx">nu</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">old</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">omit</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">kobj</span><span class="p">))));</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">selectKeys</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">ks</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pick</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">ks</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">constructPair</span><span class="p">(</span><span class="nx">pair</span><span class="p">,</span> <span class="nx">rests</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">pair</span><span class="p">),</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">rests</span><span class="p">)),</span>
            <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">pair</span><span class="p">),</span> <span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">rests</span><span class="p">))];</span>
  <span class="p">}</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">unzip</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pairs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">pairs</span><span class="p">))</span> <span class="k">return</span> <span class="p">[[],[]];</span>
    <span class="k">return</span> <span class="nx">constructPair</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">pairs</span><span class="p">),</span> <span class="nx">L</span><span class="p">.</span><span class="nx">unzip</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">pairs</span><span class="p">)));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Combinators</h2>

        
      
        
        
<p>Takes a value and returns a function that always returns
said value.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">constantly</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">always</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span> <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes some value as its first argument and runs it through a
pipeline of functions given as the rest arguments.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">pipeline</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">thrush</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">seed</span> <span class="cm">/*, args */</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">seed</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Expected a seed value.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">r</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span> <span class="p">},</span>
                    <span class="nx">seed</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Composes a number of functions, right to left, into a single
function.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">compose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* funs */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">restFuns</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">butLast</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">reverse</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">callChain</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">),</span> <span class="nx">restFuns</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">pipeline</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">callChain</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Composes a bunch of predicates into a single predicate that
checks all elements of an array for conformance to all of the
original predicates.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">conjoin</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">everyPred</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* preds */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">preds</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">preds</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">p</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Composes a bunch of predicates into a single predicate that
checks all elements of an array for conformance to any of the
original predicates.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">disjoin</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">someFun</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* preds */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">preds</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">preds</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">p</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes a function expecting regulars args and
returns a function that takes an array and
uses its elements as the args to  the original
function</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">splat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">array</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes a function expecting an array and returns
a function that takes regular args and wraps all
in an array that is passed to the original function.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">unsplat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Applicative functions</h2>

        
      
        
        
<p>Returns an array with two internal arrays built from
taking an original array and spliting it at the index
where a given function goes falsey.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">splitWith</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span></pre></div>
        
      
        
        
<p>defer seq check to the *While functions</p>

        
          <div class="highlight"><pre>    <span class="k">return</span> <span class="p">[</span><span class="nx">L</span><span class="p">.</span><span class="nx">takeWhile</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">),</span> <span class="nx">L</span><span class="p">.</span><span class="nx">dropWhile</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)];</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Updates the value at any depth in a nested object based on the
path described by the keys given.  The function provides is supplied
the current value and is expected to return a value for use as the
new value.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">ks</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isAssociative</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Attempting to assoc a non-associative object.&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">deepness</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">ks</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">keys</span>     <span class="o">=</span> <span class="nx">deepness</span> <span class="o">?</span> <span class="nx">ks</span> <span class="o">:</span> <span class="p">[</span><span class="nx">ks</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">ret</span>      <span class="o">=</span> <span class="nx">deepness</span> <span class="o">?</span> <span class="nx">L</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">lastKey</span>  <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">keys</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">target</span>   <span class="o">=</span> <span class="nx">ret</span><span class="p">;</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">butLast</span><span class="p">(</span><span class="nx">keys</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="p">});</span>

    <span class="nx">target</span><span class="p">[</span><span class="nx">lastKey</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">lastKey</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Updates the value at any depth in a nested object based on the
path described by the keys given.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">assoc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">keys</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">k</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns an array of existy results of a function over an source array.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">keep</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isSeq</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected an array for the second arg&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">pred</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">}),</span>
    <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Removes all values from an array that result in a truthy
check of a given predicate.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">notPred</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">complement</span><span class="p">(</span><span class="nx">pred</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">keep</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">notPred</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="o">?</span> <span class="nx">e</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">},</span> <span class="nx">coll</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns the maximum value of its args based on the
result of a given function.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">maxKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">sz</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">h</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sz</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">fun</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span> <span class="o">?</span> <span class="nx">h</span> <span class="o">:</span> <span class="nx">s</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">agg</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">maxKey</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">agg</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">L</span><span class="p">.</span><span class="nx">maxKey</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns an array of values found in an original array whose indexes
passed a truthy test by a given predicate.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">keepIndexed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">coll</span><span class="p">)),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">pred</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">coll</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}),</span>
    <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Maps a function over an array and concatenates all of the results.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">mapcat</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">fun</span><span class="p">));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns a function that will attempt to look up a named field
in any object that it&#39;s given.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">plucker</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">accessor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">field</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">field</span><span class="p">]);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns an array of the given function called some number of times.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">repeatedly</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">times</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">times</span><span class="p">),</span> <span class="nx">fun</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns a function that returns an array of the calls to each
given function for some arguments.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">juxt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* funs */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">funs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">funs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Call a function recursively f(f(f(args))) until a second
given function goes falsey.  Expects a seed value to start.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">iterateUntil</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doit</span><span class="p">,</span> <span class="nx">checkit</span><span class="p">,</span> <span class="nx">seed</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">doit</span><span class="p">(</span><span class="nx">seed</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">checkit</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">doit</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Redturns an array of each intermediate stage of a call to
<code>reduce</code></p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">reductions</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">acc</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">acc</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">coll</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
      <span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">acc</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Drops all items from an array while a given predicate returns truthy.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">dropWhile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isSeq</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected an array for the second arg&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">coll</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">sz</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">pred</span><span class="p">(</span><span class="nx">coll</span><span class="p">[</span><span class="nx">index</span><span class="p">])))</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes all items in an array while a given predicate returns truthy.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">takeWhile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">isSeq</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;expected an array for the second arg&quot;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">coll</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">sz</span><span class="p">;</span> <span class="nx">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">pred</span><span class="p">(</span><span class="nx">coll</span><span class="p">[</span><span class="nx">index</span><span class="p">])))</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes an array and partitions it as the given predicate changes
truth sense.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partitionBy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">coll</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">coll</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">coll</span><span class="p">))</span> <span class="k">return</span> <span class="p">[];</span>

    <span class="kd">var</span> <span class="nx">fst</span>    <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">coll</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">fstVal</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">fst</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">run</span>    <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">fst</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">takeWhile</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">fstVal</span><span class="p">,</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
    <span class="p">},</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">coll</span><span class="p">)));</span>

    <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">run</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">partitionBy</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">drop</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">run</span><span class="p">))));</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>HOFs</h2>

        
      
        
        
<p>Returns the &#39;best&#39; value in an array based on the result of a
given function.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">best</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">coll</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">?</span> <span class="nx">x</span> <span class="o">:</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns a function that reverses the sense of a given predicate.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">complement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span> <span class="cm">/*, more */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">compose</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">([</span><span class="nx">L</span><span class="p">.</span><span class="nx">not</span><span class="p">,</span> <span class="nx">pred</span><span class="p">],</span> <span class="nx">args</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="nx">pred</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
      <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Returns a function that protects a given function from receiving
non-existy values.  Each subsequent value provided to <code>fnull</code> acts
as the default to the original function should a call receive non-existy
values in the defaulted arg slots.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">fnull</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">funull</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/*args*/</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">defaults</span><span class="p">);</span>

      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sz</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
          <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">defaults</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>  [0, -1, -2].sort();
=&gt; [-1, -2, 0]
Wat</p>

        
      
        
        
<p>  [0, -1, -2].sort(L.comparator(function(x,y) { return x &lt; y }));
=&gt; [-2, -1, 0]</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">comparator</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">fun</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)))</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">truthy</span><span class="p">(</span><span class="nx">fun</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="p">)))</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Delicious curry</h2>

        
      
        
        
<p>Curries a function to one parameter.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry1</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix1</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Curries a function of two parameters from right to left.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix2</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">last</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Curries a function of three parameters from right to left.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry3</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix3</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel3</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">middle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">last</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Curries a function of four parameters from right to left.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry4</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix4</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel4</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fourth</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">third</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">second</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">third</span><span class="p">,</span> <span class="nx">fourth</span><span class="p">);</span>
          <span class="p">};</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h3>Curried impls</h3>

        
      
        
        
<p>Returns an object where each element of an array is keyed to
the number of times that it occurred in said array.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">frequencies</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">countBy</span><span class="p">)(</span><span class="nx">_</span><span class="p">.</span><span class="nx">identity</span><span class="p">);</span></pre></div>
        
      
        
        
<p>parses ints</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nb">parseInt</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">);</span></pre></div>
        
      
        
        
<p>greater-than and less-than</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">gt</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">lhs</span> <span class="o">&gt;</span> <span class="nx">rhs</span><span class="p">;</span> <span class="p">});</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">lt</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">lhs</span> <span class="o">&lt;</span> <span class="nx">rhs</span><span class="p">;</span> <span class="p">});</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">eq</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">);</span> <span class="p">});</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">is</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">lhs</span> <span class="o">===</span> <span class="nx">rhs</span><span class="p">;</span> <span class="p">});</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">oneOf</span>   <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">lhs</span><span class="p">));</span> <span class="p">});</span></pre></div>
        
      
        
        
<h2>Partial application</h2>

        
      
        
        
<p>Partially applies a function based on the presense of the
L.$ placeholder.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partial$</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">arg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">arg</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">L</span><span class="p">.</span><span class="nx">$</span> <span class="p">)</span>
          <span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">arg</span><span class="o">++</span><span class="p">];</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">f</span><span class="p">.</span><span class="nx">_original</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Partially applies a function by one argument from left to right</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partial1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Partially applies a function by two arguments from left to right</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partial2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">([</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">],</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Flips the first two args of a function</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">flip</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">flip2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Rotates the arguments of a function. For example:
   L.rot(fun(a, b, c)) =&gt; fun(b, c, a)</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">rot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">more</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">more</span><span class="p">,</span> <span class="p">[</span><span class="nx">head</span><span class="p">]));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Monadology</h2>

        
      
        
        
<p>Creates a function that works within the context of the
<code>actions</code> logic.  <code>lift</code> accepts 1 or two functions:</p>
<ol>
<li>an answer function that serves as a way to calculate a
result based on the given managed structure.</li>
<li>a state function that &#39;modifies&#39; the managed structure
to represent its current state.</li>
</ol>
<p>If a state function is not given then the result given by the
answer function serves as the state value at each step.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">lift</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">answerFun</span><span class="p">,</span> <span class="nx">stateFun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ans</span> <span class="o">=</span> <span class="nx">answerFun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span></pre></div>
        
      
        
        
<p>If no stateFun given, just carry the answer forward</p>

        
          <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">stateFun</span><span class="p">)</span> <span class="o">?</span> <span class="nx">stateFun</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">:</span> <span class="nx">ans</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">{</span><span class="nx">answer</span><span class="o">:</span> <span class="nx">ans</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="nx">s</span><span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>Takes a number of curried functions that modifies
an intermediate description of mutation.  The final
function in the sequence is meant to return the final
value in the chain.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">actions</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">acts</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">seed</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">values</span><span class="o">:</span> <span class="p">[],</span> <span class="nx">state</span><span class="o">:</span> <span class="nx">seed</span> <span class="p">};</span>

      <span class="kd">var</span> <span class="nx">intermediate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">acts</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="p">[</span><span class="nx">result</span><span class="p">.</span><span class="nx">answer</span><span class="p">]);</span>
        <span class="k">return</span> <span class="p">{</span> <span class="nx">values</span><span class="o">:</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">state</span> <span class="p">};</span>
      <span class="p">},</span> <span class="nx">init</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">keep</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">intermediate</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">keep</span><span class="p">,</span> <span class="nx">intermediate</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Ref-type mixin</h2>

        
      
        
        
<p>Mixes into a target object (destructively)</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">mix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span> <span class="cm">/*, mixins */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">target</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>The Watchable mixin encapsulates the Subscriber/Observer
pattern</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">watchers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">return</span> <span class="p">{</span></pre></div>
        
      
        
        
<p>The use of named function exprs is a temporary hack to make
these methods play nicely with <code>invoker</code>.  This is a non-portable
technique.</p>

        
          <div class="highlight"><pre>      <span class="nx">notify</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">notify</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">watchers</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">watcher</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">watcher</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">oldVal</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">watchers</span><span class="p">);</span>
      <span class="p">},</span></pre></div>
        
      
        
        
<p>The watch function accepts a callback and
a descriptive key used for associating the
callback with a name of some sort.</p>

        
          <div class="highlight"><pre>      <span class="nx">watch</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">watch</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">watchers</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">},</span></pre></div>
        
      
        
        
<p>Takes the key and unsubscribes the watcher
associated with it.</p>

        
          <div class="highlight"><pre>      <span class="nx">unwatch</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">unwatch</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="nx">watchers</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">watchers</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">watchers</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">old</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">})();</span></pre></div>
        
      
        
        
<p>The functions for use with Watchable things</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">addWatch</span>    <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">.</span><span class="nx">watch</span><span class="p">);</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">removeWatch</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">.</span><span class="nx">unwatch</span><span class="p">);</span></pre></div>
        
      
        
        
<p>A hole is a mutable cell:
 <em> Takes an initial value
 </em> Accepts an optional validator</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span> <span class="nx">validator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">validator</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">validator</span><span class="p">(</span><span class="nx">init</span><span class="p">))</span>
      <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Attempted to set invalid value &quot;</span> <span class="o">+</span> <span class="nx">init</span> <span class="o">+</span> <span class="s2">&quot; on construction&quot;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_validator</span> <span class="o">=</span> <span class="nx">validator</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<p>The Hole mixin describes the following change policy:
 <em> All value setting goes through the validator (if available)
 </em> Swaps take a function that accepts the current value and
   set the new value with its result
 * Snapshots should be values</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">HoleMixin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">setValue</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">setValue</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">validate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_validator</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">oldVal</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">existy</span><span class="p">(</span><span class="nx">validate</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validate</span><span class="p">(</span><span class="nx">newVal</span><span class="p">))</span>
          <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Attempted to set invalid value &quot;</span> <span class="o">+</span> <span class="nx">newVal</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">newVal</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">SwapMixin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">swap</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">swap</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/* , args... */</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">))));</span>
     <span class="p">},</span></pre></div>
        
      
        
        
<p>Delegate down to the L.snapshot function</p>

        
          <div class="highlight"><pre>    <span class="nx">snapshot</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">snapshot</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">HoleMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">SwapMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">);</span></pre></div>
        
      
        
        
<p>The function delegates.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setValue</span><span class="p">);</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">swap</span>     <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">swap</span><span class="p">);</span></pre></div>
        
      
        
        
<h2>CAS reference type</h2>

        
      
        
        
<p>A CAS is a Hole with compare-and-swap semantics</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">CASMixin</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        
      
        
        
<p>A compareAndSwap expects the caller to supply a
value that it expects is the current value. Change
fails if these values do not match.</p>

        
          <div class="highlight"><pre>    <span class="nx">compareAndSwap</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">compareAndSwap</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">===</span> <span class="nx">oldVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">CASMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">HoleMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">SwapMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">);</span></pre></div>
        
      
        
        
<p>The CAS function delegate.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">compareAndSwap</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compareAndSwap</span><span class="p">);</span></pre></div>
        
      
        
        
<h2>Checkers and conditions</h2>

        
      
        
        
<p><em>may get pulled out into another lib</em></p>

        
      
        
        
<p>Creates a validation function: one that takes
some number of arguments and returns a truthy value
if it &quot;looks good&quot;.  Checkers also have a <code>message</code>
field useful for building human-readble error messages.</p>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">checker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">f</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">condition1</span><span class="p">(</span><span class="cm">/* checkers */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">checkers</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">mapcat</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">isValid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">isValid</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">isValid</span><span class="p">.</span><span class="nx">message</span><span class="p">];</span>
      <span class="p">},</span> <span class="nx">checkers</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">errors</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">));</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Trampolining</h2>

        
          <div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">trampoline</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span></pre></div>
        
      
        
        
<h2>Exports and sundries</h2>

        
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">L</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">L</span> <span class="o">=</span> <span class="nx">L</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">L</span> <span class="o">=</span> <span class="nx">L</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
