<!DOCTYPE html>

<html>
<head>
  <title>lemonad.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>lemonad.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>   Lemonad.js
   <a href="http://www.functionaljs.org">http://www.functionaljs.org</a>
   (c) 2013 Fogus, Ariadne Softworks
   Lemonad may be freely distributed under the MIT license</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
<p><em>Always start with the secret JavaScript sauce...</em></p>

            </div>
            
            <div class="content"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
<h2>Dependencies</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              
<p>I want to require Underscore.js if it&#39;s not already available.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_</span> <span class="o">||</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              
<h2>Setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              
<p>Establish the root object, <code>window</code> in the browser, or <code>global</code> on the server.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              
<p>The namespace object <code>L</code> is a function in its own right that returns
a partially applied function of an arbitrary number of arguments.
For example, you can use <code>L</code> to partially apply the first argument to the
<code>_.template</code> function:</p>
<pre><code>var hi = L(_.template, &quot;Hello &lt;%= name %&gt;&quot;);
_.map([{name: &#39;Joe&#39;}, {name: &#39;Bob&#39;}, {name: &#39;Cleveland&#39;}], hi);

//=&gt; [&quot;Hello Joe&quot;, &quot;Hello Bob&quot;, &quot;Hello Cleveland&quot;]</code></pre>
<p><em>signature:</em> <code>(any* -&gt; a) -&gt; any* -&gt; (any* -&gt; a)</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">L</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              
<p>Default to the native <code>bind</code> if available</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">bind</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* arguments */</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span><span class="nx">fun</span><span class="p">);</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              
<p>Current version</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.6.0&#39;</span><span class="p">;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              
<h2>Internal utilities</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              
<p>A simple function to throw an <code>Error</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">fail</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
  <span class="p">}</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              
<p>A temporary way to derive the name of a function. I hope to
eliminate the need sooner rather than later.</p>
<p><em>signature:</em> <code>(a -&gt; b) -&gt; string</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">nom</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="s1">&#39;function &#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">src</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">fun</span><span class="p">))</span> <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Cannot derive the name of a non-function.&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">n</span><span class="p">))</span> <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
    <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Anonymous function has no name.&quot;</span><span class="p">);</span>
  <span class="p">}</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              
<p>Delegates down to the snapshot method if an object has one
or clones the object outright if not.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">snapshot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">thing</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">thing</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">thing</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">thing</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">snapshot</span><span class="p">(</span><span class="nx">thing</span><span class="p">);</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              
<h2>Useful tools</h2>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              
<p>Used as a unique value to signify certain conditions in Lemonad.
Also takes a number of args and returns an array of unique values.</p>
<p><em>signature:</em> <code>any* -&gt; [any*]</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">$</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              
<p>increment, decrement and halve</p>
<p><em>signature:</em> <code>number -&gt; number</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">inc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">dec</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">halve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">n</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              
<p>Returns the type constructor</p>
<p><em>signature:</em> <code>{any: any} -&gt; (any* -&gt; any)</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">ctor</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">?</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              
<h2>Useful predicates</h2>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              
<h3>Type predicates</h3>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              
<p>A reference is something that derives from a Lemonad Hole object</p>
<p><em>signature:</em> <code>a -&gt; boolean</code></p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">isReference</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span><span class="p">);</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              
<p>Returns a function that will invoke the given method
on any object that it receives as an argument.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">walterWhite</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">invoker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span> <span class="cm">/*, args*/</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pargs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span> <span class="cm">/* args ... */</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">nom</span><span class="p">(</span><span class="nx">method</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">targetMethod</span> <span class="o">=</span> <span class="nx">target</span><span class="p">[</span><span class="nx">methodName</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">targetMethod</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">method</span> <span class="o">===</span> <span class="nx">targetMethod</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">targetMethod</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">pargs</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              
<p>Builds a polymorphic function based on dispatch predicates.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">dispatcher</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/* funs */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">funs</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">funs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">funIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">funIndex</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">funIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="nx">funs</span><span class="p">[</span><span class="nx">funIndex</span><span class="p">];</span>
        <span class="nx">ret</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">existy</span><span class="p">(</span><span class="nx">ret</span><span class="p">))</span> <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              
<h2>Applicative functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              
<p>Returns the maximum value of its args based on the
result of a given function.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">maxKey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/*, args */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">sz</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">second</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">sz</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">h</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sz</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="p">(</span><span class="nx">fun</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span> <span class="o">?</span> <span class="nx">h</span> <span class="o">:</span> <span class="nx">s</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">agg</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">L</span><span class="p">.</span><span class="nx">maxKey</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">agg</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">L</span><span class="p">.</span><span class="nx">maxKey</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">));</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              
<p>Returns an array of values found in an original array whose indexes
passed a truthy test by a given predicate.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">keepIndexed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pred</span><span class="p">,</span> <span class="nx">coll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">coll</span><span class="p">)),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">pred</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">coll</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}),</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">);</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              
<h2>Delicious curry</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              
<p>Curries a function to one parameter.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry1</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix1</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              
<p>Curries a function of two parameters from right to left.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix2</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">last</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              
<p>Curries a function of three parameters from right to left.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry3</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix3</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel3</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">last</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">middle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">middle</span><span class="p">,</span> <span class="nx">last</span><span class="p">);</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              
<p>Curries a function of four parameters from right to left.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">curry4</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">fix4</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">schonfinkel4</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fourth</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">third</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">second</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">first</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">third</span><span class="p">,</span> <span class="nx">fourth</span><span class="p">);</span>
          <span class="p">};</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              
<p>parses ints</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nb">parseInt</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              
<p>greater-than and less-than</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">gt</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">lhs</span> <span class="o">&gt;</span> <span class="nx">rhs</span><span class="p">;</span> <span class="p">});</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">lt</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">lhs</span> <span class="o">&lt;</span> <span class="nx">rhs</span><span class="p">;</span> <span class="p">});</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">eq</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">);</span> <span class="p">});</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">is</span>      <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">lhs</span> <span class="o">===</span> <span class="nx">rhs</span><span class="p">;</span> <span class="p">});</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">oneOf</span>   <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">curry2</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="nx">L</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">lhs</span><span class="p">));</span> <span class="p">});</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              
<h2>Partial application</h2>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              
<p>Partially applies a function by one argument from left to right</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partial1</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
<p>Partially applies a function by two arguments from left to right</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">partial2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cat</span><span class="p">([</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">],</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              
<p>Rotates the arguments of a function. For example:
   L.rot(fun(a, b, c)) =&gt; fun(b, c, a)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">rot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">more</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">more</span><span class="p">,</span> <span class="p">[</span><span class="nx">head</span><span class="p">]));</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              
<h2>Monadology</h2>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              
<p>Creates a function that works within the context of the
<code>actions</code> logic.  <code>lift</code> accepts one or two functions:</p>
<ol>
<li>a required answer function that serves as a way to calculate a
result based on the given managed structure.</li>
<li>an optional state function that &#39;modifies&#39; the managed structure
to represent its current state.</li>
</ol>
<p>If a state function is not given then the result given by the
answer function serves as the state value at each step.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">lift</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">answerFun</span><span class="p">,</span> <span class="nx">stateFun</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ans</span> <span class="o">=</span> <span class="nx">answerFun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span></pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              
<p>If no stateFun given, just carry the answer forward</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">stateFun</span><span class="p">)</span> <span class="o">?</span> <span class="nx">stateFun</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">:</span> <span class="nx">ans</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">{</span><span class="nx">answer</span><span class="o">:</span> <span class="nx">ans</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="nx">s</span><span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              
<p>Takes a number of curried functions that modifies
an intermediate description of mutation.  The final
function in the sequence is meant to return the final
value in the chain.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">actions</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">acts</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">seed</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">values</span><span class="o">:</span> <span class="p">[],</span> <span class="nx">state</span><span class="o">:</span> <span class="nx">seed</span> <span class="p">};</span>

      <span class="kd">var</span> <span class="nx">intermediate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">acts</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">action</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cat</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="p">[</span><span class="nx">result</span><span class="p">.</span><span class="nx">answer</span><span class="p">]);</span>
        <span class="k">return</span> <span class="p">{</span> <span class="nx">values</span><span class="o">:</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">state</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">state</span> <span class="p">};</span>
      <span class="p">},</span> <span class="nx">init</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">keep</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">intermediate</span><span class="p">.</span><span class="nx">values</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">keep</span><span class="p">,</span> <span class="nx">intermediate</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              
<h2>Ref-type mixin</h2>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              
<p>Mixes into a target object (destructively)</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">mix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span> <span class="cm">/*, mixins */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">args</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">target</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              
<p>The Watchable mixin encapsulates the Subscriber/Observer
pattern</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">watchers</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">return</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              
<p>The use of named function exprs is a temporary hack to make
these methods play nicely with <code>invoker</code>.  This is a non-portable
technique.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">notify</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">notify</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">watchers</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">watcher</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">watcher</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">oldVal</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="nx">watchers</span><span class="p">);</span>
      <span class="p">},</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              
<p>The watch function accepts a callback and
a descriptive key used for associating the
callback with a name of some sort.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">watch</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">watch</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">watchers</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">key</span><span class="p">;</span>
      <span class="p">},</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              
<p>Takes the key and unsubscribes the watcher
associated with it.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>      <span class="nx">unwatch</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">unwatch</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">old</span> <span class="o">=</span> <span class="nx">watchers</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="nx">watchers</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">watchers</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">old</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">})();</span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              
<p>The functions for use with Watchable things</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">addWatch</span>    <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">.</span><span class="nx">watch</span><span class="p">);</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">removeWatch</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">.</span><span class="nx">unwatch</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              
<p>A hole is a mutable cell:
 <em> Takes an initial value
 </em> Accepts an optional validator</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span> <span class="nx">validator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">validator</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">validator</span><span class="p">(</span><span class="nx">init</span><span class="p">))</span>
      <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Attempted to set invalid value &quot;</span> <span class="o">+</span> <span class="nx">init</span> <span class="o">+</span> <span class="s2">&quot; on construction&quot;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_validator</span> <span class="o">=</span> <span class="nx">validator</span><span class="p">;</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              
<p>The Hole mixin describes the following change policy:
 <em> All value setting goes through the validator (if available)
 </em> Swaps take a function that accepts the current value and
   set the new value with its result
 * Snapshots should be values</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">HoleMixin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">setValue</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">setValue</span><span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">validate</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_validator</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">oldVal</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">validate</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validate</span><span class="p">(</span><span class="nx">newVal</span><span class="p">))</span>
          <span class="nx">fail</span><span class="p">(</span><span class="s2">&quot;Attempted to set invalid value &quot;</span> <span class="o">+</span> <span class="nx">newVal</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">=</span> <span class="nx">newVal</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">SwapMixin</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">swap</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">swap</span><span class="p">(</span><span class="nx">fun</span> <span class="cm">/* , args... */</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">cons</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="nx">arguments</span><span class="p">))));</span>
     <span class="p">},</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              
<p>Delegate down to the snapshot function</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">snapshot</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">snapshot</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">snapshot</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">HoleMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">SwapMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              
<p>The function delegates.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">setValue</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setValue</span><span class="p">);</span>
  <span class="nx">L</span><span class="p">.</span><span class="nx">swap</span>     <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">swap</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              
<h2>CAS reference type</h2>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              
<p>A CAS is a Hole with compare-and-swap semantics</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">L</span><span class="p">.</span><span class="nx">Hole</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">CASMixin</span> <span class="o">=</span> <span class="p">{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              
<p>A compareAndSwap expects the caller to supply a
value that it expects is the current value. Change
fails if these values do not match.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>    <span class="nx">compareAndSwap</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">compareAndSwap</span><span class="p">(</span><span class="nx">oldVal</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span> <span class="o">===</span> <span class="nx">oldVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setValue</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">L</span><span class="p">.</span><span class="nx">mix</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">CASMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">HoleMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">SwapMixin</span><span class="p">,</span>
        <span class="nx">L</span><span class="p">.</span><span class="nx">WatchableMixin</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              
<p>The CAS function delegate.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">compareAndSwap</span> <span class="o">=</span> <span class="nx">L</span><span class="p">.</span><span class="nx">meth</span><span class="p">(</span><span class="nx">L</span><span class="p">.</span><span class="nx">CAS</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compareAndSwap</span><span class="p">);</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              
<h2>Checkers and conditions</h2>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              
<p><em>may get pulled out into another lib</em></p>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              
<p>Creates a validation function: one that takes
some number of arguments and returns a truthy value
if it &quot;looks good&quot;.  Checkers also have a <code>message</code>
field useful for building human-readble error messages.</p>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="nx">L</span><span class="p">.</span><span class="nx">checker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/* args */</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fun</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">f</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">condition1</span><span class="p">(</span><span class="cm">/* checkers */</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">checkers</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>

    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">mapcat</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">isValid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">isValid</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">isValid</span><span class="p">.</span><span class="nx">message</span><span class="p">];</span>
      <span class="p">},</span> <span class="nx">checkers</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">errors</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">));</span>

      <span class="k">return</span> <span class="nx">fun</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span></pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
<h2>Exports and sundries</h2>

            </div>
            
            <div class="content"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">L</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">L</span> <span class="o">=</span> <span class="nx">L</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">L</span> <span class="o">=</span> <span class="nx">L</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
